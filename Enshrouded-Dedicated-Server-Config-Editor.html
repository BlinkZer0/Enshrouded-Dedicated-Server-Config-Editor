<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enshrouded Server Configuration Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #1a1510;
            --bg-medium: #2a211a;
            --bg-light: #3d3028;
            --accent-gold: #d4af37;
            --accent-orange: #e67e22;
            --accent-cyan: #4dd0e1;
            --accent-teal: #26a69a;
            --accent-silver: #b8c5d6;
            --text-light: #f4e4d0;
            --text-dim: #b8a590;
            --border-color: #5a4a38;
            --shadow: rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1510 0%, #2a211a 100%);
            color: var(--text-light);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background gradient */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1510 0%, #2a211a 50%, #1a1510 100%);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
            z-index: -2;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Particle container */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--accent-gold);
            border-radius: 50%;
            opacity: 0;
            animation: floatUp 8s ease-in infinite;
            box-shadow: 0 0 6px var(--accent-gold);
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) translateX(0) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.3;
            }
            100% {
                transform: translateY(-100vh) translateX(50px) scale(1);
                opacity: 0;
            }
        }

        /* Smoke particles from torches */
        .smoke-particle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, rgba(180, 180, 180, 0.5) 0%, rgba(120, 120, 120, 0.2) 40%, rgba(100, 100, 100, 0) 70%);
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
            filter: blur(4px);
            will-change: transform, opacity;
        }

        @keyframes smokeRise {
            0% {
                transform: translateY(0) translateX(0) scale(0.3);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            50% {
                opacity: 0.5;
                transform: translateY(-80px) translateX(20px) scale(2.5);
            }
            100% {
                transform: translateY(-160px) translateX(40px) scale(4);
                opacity: 0;
            }
        }

        .torch-smoke-container {
            position: absolute;
            width: 100%;
            height: 200px;
            top: 0;
            left: 0;
            pointer-events: none;
            overflow: visible;
            z-index: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, var(--bg-medium) 0%, var(--bg-light) 100%);
            border-radius: 15px;
            border: 2px solid var(--border-color);
            box-shadow: 0 10px 30px var(--shadow);
            position: relative;
            overflow: visible;
        }

        h1 {
            font-size: 2.5em;
            color: var(--accent-cyan);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7),
                         0 0 20px rgba(77, 208, 225, 0.5);
            margin-bottom: 10px;
            animation: titlePulse 8s ease-in-out infinite;
            background: linear-gradient(90deg,
                #4dd0e1 0%,
                #80deea 25%,
                #b8c5d6 50%,
                #80deea 75%,
                #4dd0e1 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titlePulse 8s ease-in-out infinite, shimmer 6s linear infinite;
        }

        @keyframes titlePulse {
            0%, 100% {
                filter: drop-shadow(0 0 10px rgba(77, 208, 225, 0.6));
            }
            50% {
                filter: drop-shadow(0 0 20px rgba(77, 208, 225, 0.9)) drop-shadow(0 0 30px rgba(38, 166, 154, 0.5));
            }
        }

        @keyframes shimmer {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 1.1em;
        }

        /* Decorative torches flanking header */
        .torch {
            position: absolute;
            top: 8px;
            width: 80px;
            height: 140px;
            opacity: 0.95;
            overflow: visible;
        }
        .torch svg {
            overflow: visible;
        }
        .torch-left { left: -20px; }
        .torch-right { right: -20px; transform: scaleX(-1); }

        @keyframes flameFlicker {
            0%   {
                transform: translateY(0) scale(1);
            }
            25%  {
                transform: translateY(-3px) scale(1.08) rotate(2deg);
            }
            50%  {
                transform: translateY(-2px) scale(1.05) rotate(-2deg);
            }
            75%  {
                transform: translateY(-4px) scale(1.1) rotate(1deg);
            }
            100% {
                transform: translateY(0) scale(0.98) rotate(-1deg);
            }
        }

        @keyframes flameGlow {
            0%, 100% {
                opacity: 0.8;
            }
            50% {
                opacity: 1;
            }
        }

        .torch .flame-primary {
            animation: flameFlicker 1.35s ease-in-out infinite alternate;
            transform-origin: 50% 100%;
            filter: blur(0.5px);
        }
        .torch .flame-secondary {
            animation: flameFlicker 1.8s ease-in-out infinite alternate;
            transform-origin: 50% 100%;
            opacity: 0.7;
            filter: blur(1px);
        }

        .torch .flame-glow {
            animation: flameFlicker 2s ease-in-out infinite alternate, flameGlow 1.5s ease-in-out infinite;
            transform-origin: 50% 100%;
            opacity: 0.4;
            filter: blur(8px);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            background: var(--bg-medium);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1em;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .tab-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(212, 175, 55, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .tab-button:active::before {
            width: 300px;
            height: 300px;
        }

        .tab-button:hover {
            background: var(--bg-light);
            border-color: var(--accent-gold);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-gold) 100%);
            border-color: var(--accent-gold);
            color: var(--bg-dark);
            animation: tabGlow 2s ease-in-out infinite;
        }

        @keyframes tabGlow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
            }
            50% {
                box-shadow: 0 0 20px rgba(212, 175, 55, 0.7);
            }
        }

        .tab-content {
            display: none;
            background: var(--bg-medium);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--border-color);
            box-shadow: 0 10px 30px var(--shadow);
        }

        .tab-content.active {
            display: block;
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .form-section {
            margin-bottom: 30px;
            opacity: 0;
            animation: sectionFadeIn 0.6s ease-out forwards;
        }

        .form-section:nth-child(1) { animation-delay: 0.1s; }
        .form-section:nth-child(2) { animation-delay: 0.2s; }
        .form-section:nth-child(3) { animation-delay: 0.3s; }
        .form-section:nth-child(4) { animation-delay: 0.4s; }
        .form-section:nth-child(5) { animation-delay: 0.5s; }

        @keyframes sectionFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 1.5em;
            color: var(--accent-gold);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            color: var(--text-light);
            font-weight: 600;
            font-size: 0.95em;
        }

        /* Inline help trigger */
        .help {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            margin-left: 8px;
            border-radius: 50%;
            border: 1px solid var(--accent-gold);
            background: var(--bg-light);
            color: var(--accent-gold);
            font-size: 12px;
            font-weight: 700;
            line-height: 1;
            cursor: help;
        }
        /* Tooltip bubble rendered to <body>, positioned in JS to avoid viewport overflow */
        .tooltip {
            position: fixed;
            top: 0; left: 0;
            display: none;
            opacity: 0;
            pointer-events: none;
            background: var(--bg-dark);
            color: var(--text-light);
            padding: 10px 12px;
            border: 2px solid var(--accent-gold);
            border-radius: 8px;
            box-shadow: 0 8px 20px var(--shadow), 0 0 15px rgba(212, 175, 55, 0.3);
            max-width: 340px;
            white-space: normal;
            word-break: break-word;
            hyphens: auto;
            z-index: 1000;
            transition: opacity 0.2s ease, transform 0.2s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            transform: scale(0.8);
        }

        .tooltip[style*="opacity: 1"] {
            transform: scale(1);
        }

        .label-description {
            color: var(--text-dim);
            font-size: 0.85em;
            font-weight: 400;
            margin-top: -4px;
        }

        input[type="text"],
        input[type="number"],
        select {
            padding: 12px;
            background: var(--bg-dark);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 1em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        input[type="text"]:hover,
        input[type="number"]:hover,
        select:hover {
            border-color: rgba(212, 175, 55, 0.5);
            transform: translateY(-1px);
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4),
                        inset 0 0 10px rgba(212, 175, 55, 0.1);
            transform: scale(1.02);
        }

        select {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23d4af37' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 35px;
            appearance: none;
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .slider-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            background: linear-gradient(to right,
                var(--accent-orange) 0%,
                var(--accent-gold) var(--range-progress, 50%),
                var(--bg-dark) var(--range-progress, 50%));
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            transition: all 0.3s ease;
            position: relative;
        }

        input[type="range"]:hover {
            height: 10px;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        /* Track styling for webkit */
        input[type="range"]::-webkit-slider-runnable-track {
            height: 8px;
            border-radius: 5px;
            background: transparent;
        }

        /* Track styling for Firefox */
        input[type="range"]::-moz-range-track {
            height: 8px;
            border-radius: 5px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
        }

        input[type="range"]::-moz-range-progress {
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--accent-orange), var(--accent-gold));
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-gold) 100%);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 0 15px var(--accent-gold), 0 0 30px rgba(212, 175, 55, 0.4);
            animation: pulse 1s ease-in-out infinite;
        }

        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.1);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-gold) 100%);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 0 15px var(--accent-gold), 0 0 30px rgba(212, 175, 55, 0.4);
            animation: pulse 1s ease-in-out infinite;
        }

        input[type="range"]::-moz-range-thumb:active {
            transform: scale(1.1);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 15px var(--accent-gold), 0 0 30px rgba(212, 175, 55, 0.4);
            }
            50% {
                box-shadow: 0 0 20px var(--accent-gold), 0 0 40px rgba(212, 175, 55, 0.6);
            }
        }

        .slider-value {
            min-width: 60px;
            padding: 8px 12px;
            background: var(--bg-dark);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
            color: var(--accent-gold);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slider-value.updating {
            transform: scale(1.15);
            color: #ffd700;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-dark);
            border: 2px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 30px;
        }

        .toggle-slider:hover {
            border-color: rgba(212, 175, 55, 0.5);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.2);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-dim);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-gold) 100%);
            border-color: var(--accent-gold);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
            background-color: var(--bg-dark);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 400px;
            height: 400px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-gold) 100%);
            color: var(--bg-dark);
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5),
                        0 0 20px rgba(212, 175, 55, 0.3);
            filter: brightness(1.1);
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(1.02);
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-light);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-dark);
            border-color: var(--accent-gold);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }

        .btn-secondary:active {
            transform: translateY(-1px) scale(1.02);
        }

        .btn-danger {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.5);
            filter: brightness(1.1);
        }

        .btn-danger:active {
            transform: translateY(-1px) scale(1.02);
        }

        .user-group {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        .user-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .user-group-title {
            font-size: 1.2em;
            color: var(--accent-gold);
            font-weight: 600;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            border-radius: 6px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-gold) 100%);
            color: var(--bg-dark);
            font-weight: 600;
            box-shadow: 0 10px 30px var(--shadow);
            z-index: 1000;
            display: none;
        }

        .notification.show {
            display: block;
            animation: notificationSlideIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .notification.hide {
            animation: notificationSlideOut 0.3s ease-in forwards;
        }

        @keyframes notificationSlideIn {
            0% {
                transform: translateX(400px) scale(0.8);
                opacity: 0;
            }
            70% {
                transform: translateX(-10px) scale(1.05);
            }
            100% {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes notificationSlideOut {
            from {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
            to {
                transform: translateX(400px) scale(0.8);
                opacity: 0;
            }
        }

        .svg-icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Accessibility: Respect reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .torch { display: none; }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .particle {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Animated particle background -->
    <div class="particles" id="particles"></div>

    <div class="container">
        <header>
            <div class="torch-smoke-container" id="torchSmoke"></div>
            <div class="torch torch-left" aria-hidden="true">
                <svg viewBox="0 0 80 140" width="80" height="140" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <!-- Flame gradients -->
                        <radialGradient id="flameGrad" cx="50%" cy="40%">
                            <stop offset="0%" stop-color="#fff9e6"/>
                            <stop offset="20%" stop-color="#ffe066"/>
                            <stop offset="50%" stop-color="#ff9933"/>
                            <stop offset="80%" stop-color="#ff6600"/>
                            <stop offset="100%" stop-color="#cc3300"/>
                        </radialGradient>
                        <radialGradient id="flameGlowGrad" cx="50%" cy="50%">
                            <stop offset="0%" stop-color="#ffcc66" stop-opacity="0.8"/>
                            <stop offset="50%" stop-color="#ff6600" stop-opacity="0.4"/>
                            <stop offset="100%" stop-color="#ff3300" stop-opacity="0"/>
                        </radialGradient>
                        <!-- Wood grain gradient -->
                        <linearGradient id="woodGrad" x1="0" y1="0" x2="1" y2="0">
                            <stop offset="0%" stop-color="#5a4332"/>
                            <stop offset="40%" stop-color="#6e543e"/>
                            <stop offset="60%" stop-color="#5a4332"/>
                            <stop offset="100%" stop-color="#4a3525"/>
                        </linearGradient>
                        <!-- Metal gradient -->
                        <linearGradient id="metalGrad" x1="0" y1="0" x2="1" y2="0">
                            <stop offset="0%" stop-color="#3d3028"/>
                            <stop offset="50%" stop-color="#5a4a38"/>
                            <stop offset="100%" stop-color="#3d3028"/>
                        </linearGradient>
                    </defs>

                    <!-- Torch handle (wood stick) -->
                    <rect x="35" y="70" width="10" height="60" rx="2" fill="url(#woodGrad)" stroke="#3d3028" stroke-width="0.5"/>
                    <ellipse cx="40" cy="70" rx="5" ry="2" fill="#4a3525"/>

                    <!-- Metal holder -->
                    <path d="M 25 65 Q 22 68, 25 70 L 30 72 L 30 80 L 25 82 Q 22 84, 25 87 L 55 87 Q 58 84, 55 82 L 50 80 L 50 72 L 55 70 Q 58 68, 55 65 Z"
                          fill="url(#metalGrad)" stroke="#2a211a" stroke-width="0.8"/>
                    <ellipse cx="40" cy="65" rx="15" ry="4" fill="#5a4a38" opacity="0.7"/>

                    <!-- Flame glow (largest, most blurred) -->
                    <ellipse class="flame-glow" cx="40" cy="35" rx="28" ry="38" fill="url(#flameGlowGrad)"/>

                    <!-- Outer flame (secondary) -->
                    <path class="flame-secondary"
                          d="M 40 10 C 32 20, 28 28, 28 38 C 28 48, 30 55, 35 60 C 37 62, 40 63, 40 63 C 40 63, 43 62, 45 60 C 50 55, 52 48, 52 38 C 52 28, 48 20, 40 10 Z"
                          fill="url(#flameGrad)" opacity="0.85"/>

                    <!-- Inner flame (primary, brighter) -->
                    <path class="flame-primary"
                          d="M 40 15 C 35 24, 33 30, 33 38 C 33 45, 35 50, 38 55 C 39 56, 40 57, 40 57 C 40 57, 41 56, 42 55 C 45 50, 47 45, 47 38 C 47 30, 45 24, 40 15 Z"
                          fill="url(#flameGrad)"/>

                    <!-- Hot center -->
                    <path class="flame-primary"
                          d="M 40 25 C 38 30, 37 35, 37 40 C 37 44, 38 47, 40 50 C 42 47, 43 44, 43 40 C 43 35, 42 30, 40 25 Z"
                          fill="#fff9e6" opacity="0.9"/>

                    <!-- Embers rising from flame -->
                    <circle cx="38" cy="20" r="1" fill="#ffcc66" opacity="0.8">
                        <animate attributeName="cy" values="20;5;20" dur="3s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" values="0.8;0;0.8" dur="3s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="42" cy="25" r="1" fill="#ffcc66" opacity="0.8">
                        <animate attributeName="cy" values="25;8;25" dur="3.5s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" values="0.8;0;0.8" dur="3.5s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            </div>
            <h1>⚔️ Enshrouded Server Configuration ⚔️</h1>
            <p class="subtitle">Customize your dedicated server settings</p>
            <div class="torch torch-right" aria-hidden="true">
                <svg viewBox="0 0 80 140" width="80" height="140" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <!-- Flame gradients -->
                        <radialGradient id="flameGradR" cx="50%" cy="40%">
                            <stop offset="0%" stop-color="#fff9e6"/>
                            <stop offset="20%" stop-color="#ffe066"/>
                            <stop offset="50%" stop-color="#ff9933"/>
                            <stop offset="80%" stop-color="#ff6600"/>
                            <stop offset="100%" stop-color="#cc3300"/>
                        </radialGradient>
                        <radialGradient id="flameGlowGradR" cx="50%" cy="50%">
                            <stop offset="0%" stop-color="#ffcc66" stop-opacity="0.8"/>
                            <stop offset="50%" stop-color="#ff6600" stop-opacity="0.4"/>
                            <stop offset="100%" stop-color="#ff3300" stop-opacity="0"/>
                        </radialGradient>
                        <!-- Wood grain gradient -->
                        <linearGradient id="woodGradR" x1="0" y1="0" x2="1" y2="0">
                            <stop offset="0%" stop-color="#5a4332"/>
                            <stop offset="40%" stop-color="#6e543e"/>
                            <stop offset="60%" stop-color="#5a4332"/>
                            <stop offset="100%" stop-color="#4a3525"/>
                        </linearGradient>
                        <!-- Metal gradient -->
                        <linearGradient id="metalGradR" x1="0" y1="0" x2="1" y2="0">
                            <stop offset="0%" stop-color="#3d3028"/>
                            <stop offset="50%" stop-color="#5a4a38"/>
                            <stop offset="100%" stop-color="#3d3028"/>
                        </linearGradient>
                    </defs>

                    <!-- Torch handle (wood stick) -->
                    <rect x="35" y="70" width="10" height="60" rx="2" fill="url(#woodGradR)" stroke="#3d3028" stroke-width="0.5"/>
                    <ellipse cx="40" cy="70" rx="5" ry="2" fill="#4a3525"/>

                    <!-- Metal holder -->
                    <path d="M 25 65 Q 22 68, 25 70 L 30 72 L 30 80 L 25 82 Q 22 84, 25 87 L 55 87 Q 58 84, 55 82 L 50 80 L 50 72 L 55 70 Q 58 68, 55 65 Z"
                          fill="url(#metalGradR)" stroke="#2a211a" stroke-width="0.8"/>
                    <ellipse cx="40" cy="65" rx="15" ry="4" fill="#5a4a38" opacity="0.7"/>

                    <!-- Flame glow (largest, most blurred) -->
                    <ellipse class="flame-glow" cx="40" cy="35" rx="28" ry="38" fill="url(#flameGlowGradR)"/>

                    <!-- Outer flame (secondary) -->
                    <path class="flame-secondary"
                          d="M 40 10 C 32 20, 28 28, 28 38 C 28 48, 30 55, 35 60 C 37 62, 40 63, 40 63 C 40 63, 43 62, 45 60 C 50 55, 52 48, 52 38 C 52 28, 48 20, 40 10 Z"
                          fill="url(#flameGradR)" opacity="0.85"/>

                    <!-- Inner flame (primary, brighter) -->
                    <path class="flame-primary"
                          d="M 40 15 C 35 24, 33 30, 33 38 C 33 45, 35 50, 38 55 C 39 56, 40 57, 40 57 C 40 57, 41 56, 42 55 C 45 50, 47 45, 47 38 C 47 30, 45 24, 40 15 Z"
                          fill="url(#flameGradR)"/>

                    <!-- Hot center -->
                    <path class="flame-primary"
                          d="M 40 25 C 38 30, 37 35, 37 40 C 37 44, 38 47, 40 50 C 42 47, 43 44, 43 40 C 43 35, 42 30, 40 25 Z"
                          fill="#fff9e6" opacity="0.9"/>

                    <!-- Embers rising from flame -->
                    <circle cx="38" cy="20" r="1" fill="#ffcc66" opacity="0.8">
                        <animate attributeName="cy" values="20;5;20" dur="3s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" values="0.8;0;0.8" dur="3s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="42" cy="25" r="1" fill="#ffcc66" opacity="0.8">
                        <animate attributeName="cy" values="25;8;25" dur="3.5s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" values="0.8;0;0.8" dur="3.5s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('general')">General Settings</button>
            <button class="tab-button" onclick="switchTab('player')">Player Settings</button>
            <button class="tab-button" onclick="switchTab('world')">World Settings</button>
            <button class="tab-button" onclick="switchTab('enemy')">Enemy Settings</button>
            <button class="tab-button" onclick="switchTab('resources')">Resources & Crafting</button>
            <button class="tab-button" onclick="switchTab('userGroups')">User Groups</button>
        </div>

        <!-- General Settings Tab -->
        <div id="general" class="tab-content active">
            <div class="form-section">
                <h2 class="section-title">Server Information</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name">Server Name <span class="help" data-tooltip="Sets the name of the server as shown in the server browser.">?</span></label>
                        <input type="text" id="name" placeholder="Enter server name">
                    </div>
                    <div class="form-group">
                        <label for="ip">IP Address <span class="help" data-tooltip="IP address to bind to. Use 0.0.0.0 to listen on all interfaces.">?</span></label>
                        <input type="text" id="ip" placeholder="0.0.0.0">
                    </div>
                    <div class="form-group">
                        <label for="queryPort">Query Port <span class="help" data-tooltip="Port used for server queries. Forward this UDP port on your router/firewall.">?</span></label>
                        <input type="number" id="queryPort" min="1024" max="65535">
                    </div>
                    <div class="form-group">
                        <label for="slotCount">Player Slots <span class="help" data-tooltip="Maximum number of concurrent players that can join (1–16).">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="slotCount" min="1" max="16" value="16" oninput="updateSliderValue('slotCount')">
                                <span class="slider-value" id="slotCount-value">16</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Communication Settings</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Enable Text Chat <span class="help" data-tooltip="Enables in‑game text chat for all connected players.">?</span></label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableTextChat">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Enable Voice Chat <span class="help" data-tooltip="Enables in‑game voice chat. Configure mode below.">?</span></label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableVoiceChat">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="voiceChatMode">Voice Chat Mode <span class="help" data-tooltip="Choose how voice chat works: Proximity (nearby players) or Global (entire server).">?</span></label>
                        <select id="voiceChatMode">
                            <option value="Proximity">Proximity</option>
                            <option value="Global">Global</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Game Preset</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="gameSettingsPreset">Difficulty Preset <span class="help" data-tooltip="Select a preset for gameplay. Choose Custom to tweak individual settings below.">?</span></label>
                        <p class="label-description">Select a preset or choose Custom for manual configuration</p>
                        <select id="gameSettingsPreset" onchange="handlePresetChange()">
                            <option value="Default">Default</option>
                            <option value="Relaxed">Relaxed</option>
                            <option value="Hard">Hard</option>
                            <option value="Survival">Survival</option>
                            <option value="Creative">Creative</option>
                            <option value="Hardcore">Hardcore</option>
                            <option value="Speedrun">Speedrun</option>
                            <option value="Custom">Custom</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Player Settings Tab -->
        <div id="player" class="tab-content">
            <div class="form-section">
                <h2 class="section-title">Player Stats</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="playerHealthFactor">Health (25% - 400%) <span class="help" data-tooltip="Scales players’ maximum health by the factor. Minimum = 0.25.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="playerHealthFactor" min="0.25" max="4" step="0.25" value="1" oninput="updateSliderValue('playerHealthFactor', '%')">
                                <span class="slider-value" id="playerHealthFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="playerManaFactor">Mana (25% - 400%) <span class="help" data-tooltip="Scales players’ maximum mana by the factor. Minimum = 0.25.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="playerManaFactor" min="0.25" max="4" step="0.25" value="1" oninput="updateSliderValue('playerManaFactor', '%')">
                                <span class="slider-value" id="playerManaFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="playerStaminaFactor">Stamina (25% - 400%) <span class="help" data-tooltip="Scales players’ maximum stamina by the factor. Minimum = 0.25.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="playerStaminaFactor" min="0.25" max="4" step="0.25" value="1" oninput="updateSliderValue('playerStaminaFactor', '%')">
                                <span class="slider-value" id="playerStaminaFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="playerBodyHeatFactor">Body Heat (0% - 200%) <span class="help" data-tooltip="Scales resistance to cold. Higher = longer before hypothermia in cold areas.">?</span></label>
                        <p class="label-description">Resistance to cold weather</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="playerBodyHeatFactor" min="0" max="2" step="0.1" value="1" oninput="updateSliderValue('playerBodyHeatFactor', '%')">
                                <span class="slider-value" id="playerBodyHeatFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Survival Mechanics</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Enable Weapon Durability <span class="help" data-tooltip="If enabled, weapons can degrade and break and must be repaired or replaced.">?</span></label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableDurability">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Enable Hunger & Starvation <span class="help" data-tooltip="If enabled, hunger/starvation apply. During starvation, health drains periodically until death if not fed.">?</span></label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableStarvingDebuff">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="foodBuffDurationFactor">Food Buff Duration (50% - 200%) <span class="help" data-tooltip="Scales how long food buffs last. Minimum = 0.5.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="foodBuffDurationFactor" min="0.5" max="2" step="0.1" value="1" oninput="updateSliderValue('foodBuffDurationFactor', '%')">
                                <span class="slider-value" id="foodBuffDurationFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fromHungerToStarving">Hungry Duration (minutes) <span class="help" data-tooltip="Length of the hungry state before starvation begins. Stored as nanoseconds in enshrouded_server.json (300e9 – 1.2e12).">?</span></label>
                        <p class="label-description">Time before starvation (5-20 min)</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="fromHungerToStarving" min="300000000000" max="1200000000000" step="60000000000" value="600000000000" oninput="updateSliderValue('fromHungerToStarving', ' min', 60000000000)">
                                <span class="slider-value" id="fromHungerToStarving-value">10 min</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="shroudTimeFactor">Shroud Time (50% - 200%) <span class="help" data-tooltip="Scales how long players can safely remain within the Shroud.">?</span></label>
                        <p class="label-description">How long you can stay in the Shroud</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="shroudTimeFactor" min="0.5" max="2" step="0.1" value="1" oninput="updateSliderValue('shroudTimeFactor', '%')">
                                <span class="slider-value" id="shroudTimeFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="tombstoneMode">Tombstone Mode <span class="help" data-tooltip="Controls item loss on death. AddBackpackMaterials: lose materials only; Everything: lose all; NoTombstone: keep everything. Lost items appear in a tombstone and can be recovered.">?</span></label>
                        <p class="label-description">What happens when you die</p>
                        <select id="tombstoneMode">
                            <option value="AddBackpackMaterials">Lose Materials Only</option>
                            <option value="Everything">Lose Everything</option>
                            <option value="NoTombstone">Keep Everything</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="curseModifier">Shroud Curse Difficulty <span class="help" data-tooltip="Adjusts the likelihood/severity of Shroud curses encountered in cursed areas.">?</span></label>
                        <select id="curseModifier">
                            <option value="Easy">Easy (Disabled)</option>
                            <option value="Normal">Normal</option>
                            <option value="Hard">Hard (2x chance)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Experience Gain</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="experienceCombatFactor">Combat XP (25% - 200%) <span class="help" data-tooltip="Scales XP gained from combat. Minimum = 0.25.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="experienceCombatFactor" min="0.25" max="2" step="0.25" value="1" oninput="updateSliderValue('experienceCombatFactor', '%')">
                                <span class="slider-value" id="experienceCombatFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="experienceMiningFactor">Mining XP (0% - 200%) <span class="help" data-tooltip="Scales XP gained from mining resources.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="experienceMiningFactor" min="0" max="2" step="0.25" value="1" oninput="updateSliderValue('experienceMiningFactor', '%')">
                                <span class="slider-value" id="experienceMiningFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="experienceExplorationQuestsFactor">Exploration/Quest XP (25% - 200%) <span class="help" data-tooltip="Scales XP gained from exploration and completing quests. Minimum = 0.25.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="experienceExplorationQuestsFactor" min="0.25" max="2" step="0.25" value="1" oninput="updateSliderValue('experienceExplorationQuestsFactor', '%')">
                                <span class="slider-value" id="experienceExplorationQuestsFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- World Settings Tab -->
        <div id="world" class="tab-content">
            <div class="form-section">
                <h2 class="section-title">Day/Night Cycle</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="dayTimeDuration">Daytime Duration (minutes) <span class="help" data-tooltip="Length of daytime. Stored as nanoseconds in enshrouded_server.json (120e9 – 3.6e12). Smaller value = shorter day.">?</span></label>
                        <p class="label-description">2-60 minutes</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="dayTimeDuration" min="120000000000" max="3600000000000" step="60000000000" value="1800000000000" oninput="updateSliderValue('dayTimeDuration', ' min', 60000000000)">
                                <span class="slider-value" id="dayTimeDuration-value">30 min</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="nightTimeDuration">Nighttime Duration (minutes) <span class="help" data-tooltip="Length of nighttime. Stored as nanoseconds in enshrouded_server.json (120e9 – 3.6e12). Smaller value = shorter night.">?</span></label>
                        <p class="label-description">2-60 minutes</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="nightTimeDuration" min="120000000000" max="3600000000000" step="60000000000" value="720000000000" oninput="updateSliderValue('nightTimeDuration', ' min', 60000000000)">
                                <span class="slider-value" id="nightTimeDuration-value">12 min</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Weather & Environment</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="weatherFrequency">Weather Frequency <span class="help" data-tooltip="Controls how often weather events occur: Disabled, Rare, Normal, Often.">?</span></label>
                        <select id="weatherFrequency">
                            <option value="Disabled">Disabled</option>
                            <option value="Rare">Rare</option>
                            <option value="Normal">Normal</option>
                            <option value="Often">Often</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Enable Glider Turbulences <span class="help" data-tooltip="If enabled, gliders experience turbulence and wind effects.">?</span></label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableGliderTurbulences">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Wildlife</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="tamingStartleRepercussion">Taming Failure Penalty <span class="help" data-tooltip="Penalty applied when a tame is startled/failed: Keep Progress, Lose Some Progress, or Lose All Progress.">?</span></label>
                        <select id="tamingStartleRepercussion">
                            <option value="KeepProgress">Keep Progress</option>
                            <option value="LoseSomeProgress">Lose Some Progress</option>
                            <option value="LoseAllProgress">Lose All Progress</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enemy Settings Tab -->
        <div id="enemy" class="tab-content">
            <div class="form-section">
                <h2 class="section-title">Enemy Spawning</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="randomSpawnerAmount">Enemy Amount <span class="help" data-tooltip="Sets the overall amount of enemies present in the world (Few → Extreme).">?</span></label>
                        <select id="randomSpawnerAmount">
                            <option value="Few">Few</option>
                            <option value="Normal">Normal</option>
                            <option value="Many">Many</option>
                            <option value="Extreme">Extreme</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="aggroPoolAmount">Simultaneous Attackers <span class="help" data-tooltip="Sets how many enemies are allowed to attack a player at once.">?</span></label>
                        <select id="aggroPoolAmount">
                            <option value="Few">Few</option>
                            <option value="Normal">Normal</option>
                            <option value="Many">Many</option>
                            <option value="Extreme">Extreme</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pacify All Enemies <span class="help" data-tooltip="If enabled, enemies will not attack unless provoked.">?</span></label>
                        <p class="label-description">Enemies won't attack unless provoked</p>
                        <label class="toggle-switch">
                            <input type="checkbox" id="pacifyAllEnemies">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Regular Enemy Stats</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="enemyDamageFactor">Enemy Damage (25% - 500%) <span class="help" data-tooltip="Scales damage dealt by regular enemies (not bosses). Minimum = 0.25.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="enemyDamageFactor" min="0.25" max="5" step="0.25" value="1" oninput="updateSliderValue('enemyDamageFactor', '%')">
                                <span class="slider-value" id="enemyDamageFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="enemyHealthFactor">Enemy Health (25% - 400%) <span class="help" data-tooltip="Scales health of regular enemies (not bosses). Minimum = 0.25.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="enemyHealthFactor" min="0.25" max="4" step="0.25" value="1" oninput="updateSliderValue('enemyHealthFactor', '%')">
                                <span class="slider-value" id="enemyHealthFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="enemyStaminaFactor">Enemy Stamina (50% - 200%) <span class="help" data-tooltip="Scales enemy stamina. Higher values make enemies harder to stun. Minimum = 0.5.">?</span></label>
                        <p class="label-description">Higher = harder to stun</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="enemyStaminaFactor" min="0.5" max="2" step="0.1" value="1" oninput="updateSliderValue('enemyStaminaFactor', '%')">
                                <span class="slider-value" id="enemyStaminaFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="enemyPerceptionRangeFactor">Enemy Perception (50% - 200%) <span class="help" data-tooltip="Scales how far regular enemies can see and hear a player. Minimum = 0.5.">?</span></label>
                        <p class="label-description">How far enemies can see/hear</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="enemyPerceptionRangeFactor" min="0.5" max="2" step="0.1" value="1" oninput="updateSliderValue('enemyPerceptionRangeFactor', '%')">
                                <span class="slider-value" id="enemyPerceptionRangeFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="threatBonus">Attack Frequency (25% - 400%) <span class="help" data-tooltip="Scales how frequently enemies attack or gain aggro pressure. Higher = more frequent pressure.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="threatBonus" min="0.25" max="4" step="0.25" value="1" oninput="updateSliderValue('threatBonus', '%')">
                                <span class="slider-value" id="threatBonus-value">100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Boss Stats</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="bossDamageFactor">Boss Damage (20% - 500%) <span class="help" data-tooltip="Scales damage dealt by bosses. Minimum = 0.2.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="bossDamageFactor" min="0.2" max="5" step="0.2" value="1" oninput="updateSliderValue('bossDamageFactor', '%')">
                                <span class="slider-value" id="bossDamageFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bossHealthFactor">Boss Health (20% - 500%) <span class="help" data-tooltip="Scales health of bosses. Minimum = 0.2.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="bossHealthFactor" min="0.2" max="5" step="0.2" value="1" oninput="updateSliderValue('bossHealthFactor', '%')">
                                <span class="slider-value" id="bossHealthFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resources & Crafting Tab -->
        <div id="resources" class="tab-content">
            <div class="form-section">
                <h2 class="section-title">Resource Gathering</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="miningDamageFactor">Mining Effectiveness (50% - 200%) <span class="help" data-tooltip="Scales mining damage and yield per hit (also affects terraforming).">?</span></label>
                        <p class="label-description">Damage and yield per hit</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="miningDamageFactor" min="0.5" max="2" step="0.1" value="1" oninput="updateSliderValue('miningDamageFactor', '%')">
                                <span class="slider-value" id="miningDamageFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="resourceDropStackAmountFactor">Resource Gain (25% - 200%) <span class="help" data-tooltip="Scales materials gained per loot stack from drops and containers.">?</span></label>
                        <p class="label-description">Materials per loot stack</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="resourceDropStackAmountFactor" min="0.25" max="2" step="0.25" value="1" oninput="updateSliderValue('resourceDropStackAmountFactor', '%')">
                                <span class="slider-value" id="resourceDropStackAmountFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Production & Farming</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="plantGrowthSpeedFactor">Plant Growth Speed (25% - 200%) <span class="help" data-tooltip="Scales how quickly planted crops grow.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="plantGrowthSpeedFactor" min="0.25" max="2" step="0.25" value="1" oninput="updateSliderValue('plantGrowthSpeedFactor', '%')">
                                <span class="slider-value" id="plantGrowthSpeedFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="factoryProductionSpeedFactor">Workstation Speed (25% - 200%) <span class="help" data-tooltip="Scales production times for workshop items. Minimum = 0.25.">?</span></label>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="factoryProductionSpeedFactor" min="0.25" max="2" step="0.25" value="1" oninput="updateSliderValue('factoryProductionSpeedFactor', '%')">
                                <span class="slider-value" id="factoryProductionSpeedFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Weapon Upgrades</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="perkCostFactor">Upgrade Cost (25% - 200%) <span class="help" data-tooltip="Scales Rune cost required for upgrading weapons. Minimum = 0.25.">?</span></label>
                        <p class="label-description">Runes required for upgrades</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="perkCostFactor" min="0.25" max="2" step="0.25" value="1" oninput="updateSliderValue('perkCostFactor', '%')">
                                <span class="slider-value" id="perkCostFactor-value">100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="perkUpgradeRecyclingFactor">Recycling Yield (0% - 100%) <span class="help" data-tooltip="Scales Runes returned when salvaging upgraded weapons.">?</span></label>
                        <p class="label-description">Runes returned when salvaging</p>
                        <div class="slider-container">
                            <div class="slider-wrapper">
                                <input type="range" id="perkUpgradeRecyclingFactor" min="0" max="1" step="0.1" value="0.5" oninput="updateSliderValue('perkUpgradeRecyclingFactor', '%')">
                                <span class="slider-value" id="perkUpgradeRecyclingFactor-value">50%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Groups Tab -->
        <div id="userGroups" class="tab-content">
            <div class="form-section">
                <h2 class="section-title">User Groups & Permissions</h2>
                <p class="label-description" style="margin-bottom: 20px;">Define password-protected groups with different permission levels</p>

                <div id="userGroupsContainer"></div>

                <button class="btn btn-secondary" onclick="addUserGroup()">
                    <svg class="svg-icon" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Add New User Group
                </button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileSelect(event)">
            <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">
                <svg class="svg-icon" viewBox="0 0 24 24">
                    <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/>
                </svg>
                Load Config
            </button>
            <button class="btn btn-primary" onclick="saveConfig()">
                <svg class="svg-icon" viewBox="0 0 24 24">
                    <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                </svg>
                Save Configuration
            </button>
            <button class="btn btn-danger" onclick="resetToDefaults()">
                <svg class="svg-icon" viewBox="0 0 24 24">
                    <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
                </svg>
                Reset to Defaults
            </button>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        let config = {};

        // Initialize tooltips that clamp to the viewport and wrap as needed
        (function () {
            const margin = 12;
            let active = null;

            function positionTooltip(helpEl, tipEl) {
                const rect = helpEl.getBoundingClientRect();
                tipEl.style.display = 'block';
                tipEl.style.visibility = 'hidden';

                const vw = window.innerWidth;
                const vh = window.innerHeight;

                const tipW = tipEl.offsetWidth;
                const tipH = tipEl.offsetHeight;

                let top = rect.top - tipH - 10; // prefer above
                if (top < margin) {
                    top = rect.bottom + 10; // flip below if not enough space
                }

                let left = rect.left + (rect.width / 2) - (tipW / 2);
                if (left < margin) left = margin;
                if (left + tipW > vw - margin) left = Math.max(margin, vw - margin - tipW);

                // Clamp vertical if needed
                if (top + tipH > vh - margin) top = Math.max(margin, vh - margin - tipH);

                // Fixed positioning uses viewport coordinates
                tipEl.style.top = Math.round(top) + 'px';
                tipEl.style.left = Math.round(left) + 'px';

                tipEl.style.visibility = 'visible';
                tipEl.style.opacity = '1';
            }

            function attachTooltip(helpEl) {
                const tipEl = document.createElement('span');
                tipEl.className = 'tooltip';
                tipEl.textContent = helpEl.dataset.tooltip || '';
                document.body.appendChild(tipEl);

                const open = () => {
                    active = { helpEl, tipEl };
                    positionTooltip(helpEl, tipEl);
                };
                const close = () => {
                    if (active && active.tipEl === tipEl) active = null;
                    tipEl.style.opacity = '0';
                    tipEl.style.visibility = 'hidden';
                    tipEl.style.display = 'none';
                };

                helpEl.setAttribute('tabindex', '0');
                helpEl.addEventListener('mouseenter', open);
                helpEl.addEventListener('focus', open);
                helpEl.addEventListener('mouseleave', close);
                helpEl.addEventListener('blur', close);

                window.addEventListener('scroll', () => {
                    if (active && active.tipEl === tipEl) positionTooltip(helpEl, tipEl);
                }, { passive: true });
                window.addEventListener('resize', () => {
                    if (active && active.tipEl === tipEl) positionTooltip(helpEl, tipEl);
                });
            }

            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.help').forEach(attachTooltip);
            });
        })();

        // Switch between tabs
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');

            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Update slider value display with animation
        function updateSliderValue(id, suffix = '', divisor = 1) {
            const slider = document.getElementById(id);
            const valueDisplay = document.getElementById(id + '-value');
            let value = parseFloat(slider.value);

            if (divisor !== 1) {
                value = value / divisor;
            }

            // Add animation class
            valueDisplay.classList.add('updating');
            setTimeout(() => valueDisplay.classList.remove('updating'), 300);

            if (suffix === '%') {
                valueDisplay.textContent = Math.round(value * 100) + suffix;
            } else {
                valueDisplay.textContent = value + suffix;
            }

            // Update slider progress gradient
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const percentage = ((slider.value - min) / (max - min)) * 100;
            slider.style.setProperty('--range-progress', percentage + '%');
        }

        // Handle preset change
        function handlePresetChange() {
            const preset = document.getElementById('gameSettingsPreset').value;
            if (preset !== 'Custom') {
                if (confirm(`Switching to ${preset} preset will override your custom settings. Continue?`)) {
                    // Collect current UI values to preserve general settings and user groups
                    collectConfigFromUI();
                    applyPreset(preset);
                } else {
                    // Revert to previous selection if user cancels
                    document.getElementById('gameSettingsPreset').value = config.gameSettingsPreset || 'Default';
                }
            } else {
                // User selected Custom, update the config
                config.gameSettingsPreset = 'Custom';
            }
        }

        // Apply difficulty preset
        function applyPreset(preset) {
            const presets = {
                'Default': {
                    playerHealthFactor: 1, playerManaFactor: 1, playerStaminaFactor: 1,
                    playerBodyHeatFactor: 1, enableDurability: true, enableStarvingDebuff: false,
                    foodBuffDurationFactor: 1, fromHungerToStarving: 600000000000,
                    shroudTimeFactor: 1, tombstoneMode: 'AddBackpackMaterials',
                    enableGliderTurbulences: true, weatherFrequency: 'Normal',
                    miningDamageFactor: 1, plantGrowthSpeedFactor: 1,
                    resourceDropStackAmountFactor: 1, factoryProductionSpeedFactor: 1,
                    perkUpgradeRecyclingFactor: 0.5, perkCostFactor: 1,
                    experienceCombatFactor: 1, experienceMiningFactor: 1,
                    experienceExplorationQuestsFactor: 1, randomSpawnerAmount: 'Normal',
                    aggroPoolAmount: 'Normal', enemyDamageFactor: 1, enemyHealthFactor: 1,
                    enemyStaminaFactor: 1, enemyPerceptionRangeFactor: 1,
                    bossDamageFactor: 1, bossHealthFactor: 1, threatBonus: 1,
                    pacifyAllEnemies: false, tamingStartleRepercussion: 'LoseSomeProgress',
                    dayTimeDuration: 1800000000000, nightTimeDuration: 720000000000,
                    curseModifier: 'Normal'
                },
                'Relaxed': {
                    playerHealthFactor: 2, playerManaFactor: 1, playerStaminaFactor: 1,
                    playerBodyHeatFactor: 1.5, enableDurability: true, enableStarvingDebuff: false,
                    foodBuffDurationFactor: 1, fromHungerToStarving: 600000000000,
                    shroudTimeFactor: 1, tombstoneMode: 'AddBackpackMaterials',
                    enableGliderTurbulences: true, weatherFrequency: 'Normal',
                    miningDamageFactor: 1, plantGrowthSpeedFactor: 2,
                    resourceDropStackAmountFactor: 1, factoryProductionSpeedFactor: 2,
                    perkUpgradeRecyclingFactor: 0.5, perkCostFactor: 1,
                    experienceCombatFactor: 1, experienceMiningFactor: 1,
                    experienceExplorationQuestsFactor: 1, randomSpawnerAmount: 'Few',
                    aggroPoolAmount: 'Few', enemyDamageFactor: 0.5, enemyHealthFactor: 0.5,
                    enemyStaminaFactor: 1, enemyPerceptionRangeFactor: 1,
                    bossDamageFactor: 0.5, bossHealthFactor: 0.5, threatBonus: 1,
                    pacifyAllEnemies: false, tamingStartleRepercussion: 'LoseSomeProgress',
                    dayTimeDuration: 1800000000000, nightTimeDuration: 720000000000,
                    curseModifier: 'Normal'
                },
                'Hard': {
                    playerHealthFactor: 1, playerManaFactor: 1, playerStaminaFactor: 1,
                    playerBodyHeatFactor: 1, enableDurability: true, enableStarvingDebuff: false,
                    foodBuffDurationFactor: 1, fromHungerToStarving: 600000000000,
                    shroudTimeFactor: 1, tombstoneMode: 'AddBackpackMaterials',
                    enableGliderTurbulences: true, weatherFrequency: 'Normal',
                    miningDamageFactor: 1, plantGrowthSpeedFactor: 1,
                    resourceDropStackAmountFactor: 1, factoryProductionSpeedFactor: 1,
                    perkUpgradeRecyclingFactor: 0.5, perkCostFactor: 1,
                    experienceCombatFactor: 1, experienceMiningFactor: 1,
                    experienceExplorationQuestsFactor: 1, randomSpawnerAmount: 'Many',
                    aggroPoolAmount: 'Many', enemyDamageFactor: 1.5, enemyHealthFactor: 1,
                    enemyStaminaFactor: 1, enemyPerceptionRangeFactor: 1,
                    bossDamageFactor: 1.5, bossHealthFactor: 1, threatBonus: 1,
                    pacifyAllEnemies: false, tamingStartleRepercussion: 'LoseSomeProgress',
                    dayTimeDuration: 1800000000000, nightTimeDuration: 720000000000,
                    curseModifier: 'Normal'
                },
                'Survival': {
                    playerHealthFactor: 0.75, playerManaFactor: 1, playerStaminaFactor: 1,
                    playerBodyHeatFactor: 1, enableDurability: true, enableStarvingDebuff: true,
                    foodBuffDurationFactor: 1, fromHungerToStarving: 600000000000,
                    shroudTimeFactor: 1, tombstoneMode: 'AddBackpackMaterials',
                    enableGliderTurbulences: true, weatherFrequency: 'Normal',
                    miningDamageFactor: 1, plantGrowthSpeedFactor: 1,
                    resourceDropStackAmountFactor: 1, factoryProductionSpeedFactor: 1,
                    perkUpgradeRecyclingFactor: 0.5, perkCostFactor: 1,
                    experienceCombatFactor: 1, experienceMiningFactor: 1,
                    experienceExplorationQuestsFactor: 1, randomSpawnerAmount: 'Many',
                    aggroPoolAmount: 'Many', enemyDamageFactor: 1.5, enemyHealthFactor: 1,
                    enemyStaminaFactor: 1, enemyPerceptionRangeFactor: 1,
                    bossDamageFactor: 1.5, bossHealthFactor: 1, threatBonus: 1,
                    pacifyAllEnemies: false, tamingStartleRepercussion: 'LoseSomeProgress',
                    dayTimeDuration: 1800000000000, nightTimeDuration: 720000000000,
                    curseModifier: 'Hard'
                },
                'Creative': {
                    playerHealthFactor: 4, playerManaFactor: 4, playerStaminaFactor: 4,
                    playerBodyHeatFactor: 2, enableDurability: false, enableStarvingDebuff: false,
                    foodBuffDurationFactor: 2, fromHungerToStarving: 600000000000,
                    shroudTimeFactor: 4, tombstoneMode: 'NoTombstone',
                    enableGliderTurbulences: false, weatherFrequency: 'Rare',
                    miningDamageFactor: 4, plantGrowthSpeedFactor: 4,
                    resourceDropStackAmountFactor: 4, factoryProductionSpeedFactor: 4,
                    perkUpgradeRecyclingFactor: 1, perkCostFactor: 0.25,
                    experienceCombatFactor: 4, experienceMiningFactor: 4,
                    experienceExplorationQuestsFactor: 4, randomSpawnerAmount: 'Few',
                    aggroPoolAmount: 'Few', enemyDamageFactor: 0.25, enemyHealthFactor: 0.25,
                    enemyStaminaFactor: 0.5, enemyPerceptionRangeFactor: 0.5,
                    bossDamageFactor: 0.25, bossHealthFactor: 0.25, threatBonus: 0.25,
                    pacifyAllEnemies: false, tamingStartleRepercussion: 'NoRepercussion',
                    dayTimeDuration: 2400000000000, nightTimeDuration: 480000000000,
                    curseModifier: 'Easy'
                },
                'Hardcore': {
                    playerHealthFactor: 0.5, playerManaFactor: 0.75, playerStaminaFactor: 0.75,
                    playerBodyHeatFactor: 0.5, enableDurability: true, enableStarvingDebuff: true,
                    foodBuffDurationFactor: 0.5, fromHungerToStarving: 300000000000,
                    shroudTimeFactor: 0.5, tombstoneMode: 'Everything',
                    enableGliderTurbulences: true, weatherFrequency: 'Often',
                    miningDamageFactor: 0.75, plantGrowthSpeedFactor: 0.5,
                    resourceDropStackAmountFactor: 0.75, factoryProductionSpeedFactor: 0.75,
                    perkUpgradeRecyclingFactor: 0.25, perkCostFactor: 2,
                    experienceCombatFactor: 0.75, experienceMiningFactor: 0.75,
                    experienceExplorationQuestsFactor: 0.75, randomSpawnerAmount: 'Extreme',
                    aggroPoolAmount: 'Extreme', enemyDamageFactor: 2, enemyHealthFactor: 1.5,
                    enemyStaminaFactor: 1.5, enemyPerceptionRangeFactor: 1.5,
                    bossDamageFactor: 2, bossHealthFactor: 2, threatBonus: 2,
                    pacifyAllEnemies: false, tamingStartleRepercussion: 'LoseAllProgress',
                    dayTimeDuration: 1200000000000, nightTimeDuration: 1080000000000,
                    curseModifier: 'Hard'
                },
                'Speedrun': {
                    playerHealthFactor: 1.5, playerManaFactor: 1.5, playerStaminaFactor: 1.5,
                    playerBodyHeatFactor: 1.5, enableDurability: true, enableStarvingDebuff: false,
                    foodBuffDurationFactor: 2, fromHungerToStarving: 600000000000,
                    shroudTimeFactor: 2, tombstoneMode: 'AddBackpackMaterials',
                    enableGliderTurbulences: false, weatherFrequency: 'Rare',
                    miningDamageFactor: 3, plantGrowthSpeedFactor: 3,
                    resourceDropStackAmountFactor: 2, factoryProductionSpeedFactor: 3,
                    perkUpgradeRecyclingFactor: 0.75, perkCostFactor: 0.5,
                    experienceCombatFactor: 2, experienceMiningFactor: 2,
                    experienceExplorationQuestsFactor: 2, randomSpawnerAmount: 'Normal',
                    aggroPoolAmount: 'Normal', enemyDamageFactor: 0.75, enemyHealthFactor: 0.75,
                    enemyStaminaFactor: 1, enemyPerceptionRangeFactor: 1,
                    bossDamageFactor: 1, bossHealthFactor: 1, threatBonus: 1,
                    pacifyAllEnemies: false, tamingStartleRepercussion: 'LoseSomeProgress',
                    dayTimeDuration: 1800000000000, nightTimeDuration: 720000000000,
                    curseModifier: 'Normal'
                }
            };

            if (presets[preset]) {
                if (!config.gameSettings) config.gameSettings = {};
                Object.assign(config.gameSettings, presets[preset]);
                config.gameSettingsPreset = preset;
                loadConfigToUI();
                showNotification(`${preset} preset applied!`);
            }
        }

        // Handle file selection
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        config = JSON.parse(e.target.result);
                        loadConfigToUI();
                        showNotification('Configuration loaded successfully!');
                    } catch (error) {
                        showNotification('Error parsing JSON: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        }

        // Load configuration from file (fallback for auto-load)
        async function loadConfig() {
            try {
                const response = await fetch('enshrouded_server.json');
                config = await response.json();
                loadConfigToUI();
                showNotification('Configuration loaded from enshrouded_server.json');
            } catch (error) {
                // No config file found - load defaults
                console.log('No config file found, loading default values');
                loadDefaultConfig();
            }
        }

        // Load default configuration on first load
        function loadDefaultConfig() {
            config = {
                name: 'Enshrouded Server',
                saveDirectory: './savegame',
                logDirectory: './logs',
                ip: '0.0.0.0',
                queryPort: 15637,
                slotCount: 16,
                voiceChatMode: 'Proximity',
                enableVoiceChat: false,
                enableTextChat: false,
                gameSettingsPreset: 'Default',
                gameSettings: {
                    playerHealthFactor: 1,
                    playerManaFactor: 1,
                    playerStaminaFactor: 1,
                    playerBodyHeatFactor: 1,
                    enableDurability: true,
                    enableStarvingDebuff: false,
                    foodBuffDurationFactor: 1,
                    fromHungerToStarving: 600000000000,
                    shroudTimeFactor: 1,
                    tombstoneMode: 'AddBackpackMaterials',
                    enableGliderTurbulences: true,
                    weatherFrequency: 'Normal',
                    miningDamageFactor: 1,
                    plantGrowthSpeedFactor: 1,
                    resourceDropStackAmountFactor: 1,
                    factoryProductionSpeedFactor: 1,
                    perkUpgradeRecyclingFactor: 0.5,
                    perkCostFactor: 1,
                    experienceCombatFactor: 1,
                    experienceMiningFactor: 1,
                    experienceExplorationQuestsFactor: 1,
                    randomSpawnerAmount: 'Normal',
                    aggroPoolAmount: 'Normal',
                    enemyDamageFactor: 1,
                    enemyHealthFactor: 1,
                    enemyStaminaFactor: 1,
                    enemyPerceptionRangeFactor: 1,
                    bossDamageFactor: 1,
                    bossHealthFactor: 1,
                    threatBonus: 1,
                    pacifyAllEnemies: false,
                    tamingStartleRepercussion: 'LoseSomeProgress',
                    dayTimeDuration: 1800000000000,
                    nightTimeDuration: 720000000000,
                    curseModifier: 'Normal'
                },
                userGroups: [
                    {
                        name: 'Admin',
                        password: 'AdminXXXXXXXX',
                        canKickBan: true,
                        canAccessInventories: true,
                        canEditBase: true,
                        canExtendBase: true,
                        reservedSlots: 0
                    },
                    {
                        name: 'Friend',
                        password: 'FriendXXXXXXXX',
                        canKickBan: false,
                        canAccessInventories: true,
                        canEditBase: true,
                        canExtendBase: false,
                        reservedSlots: 0
                    },
                    {
                        name: 'Guest',
                        password: 'GuestXXXXXXXX',
                        canKickBan: false,
                        canAccessInventories: false,
                        canEditBase: false,
                        canExtendBase: false,
                        reservedSlots: 0
                    }
                ]
            };
            loadConfigToUI();
        }

        // Load config data into UI
        function loadConfigToUI() {
            // General settings
            document.getElementById('name').value = config.name || '';
            document.getElementById('ip').value = config.ip || '0.0.0.0';
            document.getElementById('queryPort').value = config.queryPort || 15637;
            document.getElementById('slotCount').value = config.slotCount || 16;
            updateSliderValue('slotCount');

            document.getElementById('enableTextChat').checked = config.enableTextChat || false;
            document.getElementById('enableVoiceChat').checked = config.enableVoiceChat || false;
            document.getElementById('voiceChatMode').value = config.voiceChatMode || 'Proximity';
            document.getElementById('gameSettingsPreset').value = config.gameSettingsPreset || 'Default';

            // Game settings
            if (config.gameSettings) {
                const gs = config.gameSettings;

                // Player stats
                setSliderValue('playerHealthFactor', gs.playerHealthFactor, '%');
                setSliderValue('playerManaFactor', gs.playerManaFactor, '%');
                setSliderValue('playerStaminaFactor', gs.playerStaminaFactor, '%');
                setSliderValue('playerBodyHeatFactor', gs.playerBodyHeatFactor, '%');

                // Survival
                document.getElementById('enableDurability').checked = gs.enableDurability !== false;
                document.getElementById('enableStarvingDebuff').checked = gs.enableStarvingDebuff || false;
                setSliderValue('foodBuffDurationFactor', gs.foodBuffDurationFactor, '%');
                setSliderValue('fromHungerToStarving', gs.fromHungerToStarving, ' min', 60000000000);
                setSliderValue('shroudTimeFactor', gs.shroudTimeFactor, '%');
                document.getElementById('tombstoneMode').value = gs.tombstoneMode || 'AddBackpackMaterials';
                document.getElementById('curseModifier').value = gs.curseModifier || 'Normal';

                // Experience
                setSliderValue('experienceCombatFactor', gs.experienceCombatFactor, '%');
                setSliderValue('experienceMiningFactor', gs.experienceMiningFactor, '%');
                setSliderValue('experienceExplorationQuestsFactor', gs.experienceExplorationQuestsFactor, '%');

                // World
                setSliderValue('dayTimeDuration', gs.dayTimeDuration, ' min', 60000000000);
                setSliderValue('nightTimeDuration', gs.nightTimeDuration, ' min', 60000000000);
                document.getElementById('weatherFrequency').value = gs.weatherFrequency || 'Normal';
                document.getElementById('enableGliderTurbulences').checked = gs.enableGliderTurbulences !== false;
                document.getElementById('tamingStartleRepercussion').value = gs.tamingStartleRepercussion || 'LoseSomeProgress';

                // Enemies
                document.getElementById('randomSpawnerAmount').value = gs.randomSpawnerAmount || 'Normal';
                document.getElementById('aggroPoolAmount').value = gs.aggroPoolAmount || 'Normal';
                document.getElementById('pacifyAllEnemies').checked = gs.pacifyAllEnemies || false;
                setSliderValue('enemyDamageFactor', gs.enemyDamageFactor, '%');
                setSliderValue('enemyHealthFactor', gs.enemyHealthFactor, '%');
                setSliderValue('enemyStaminaFactor', gs.enemyStaminaFactor, '%');
                setSliderValue('enemyPerceptionRangeFactor', gs.enemyPerceptionRangeFactor, '%');
                setSliderValue('bossDamageFactor', gs.bossDamageFactor, '%');
                setSliderValue('bossHealthFactor', gs.bossHealthFactor, '%');
                setSliderValue('threatBonus', gs.threatBonus, '%');

                // Resources
                setSliderValue('miningDamageFactor', gs.miningDamageFactor, '%');
                setSliderValue('resourceDropStackAmountFactor', gs.resourceDropStackAmountFactor, '%');
                setSliderValue('plantGrowthSpeedFactor', gs.plantGrowthSpeedFactor, '%');
                setSliderValue('factoryProductionSpeedFactor', gs.factoryProductionSpeedFactor, '%');
                setSliderValue('perkCostFactor', gs.perkCostFactor, '%');
                setSliderValue('perkUpgradeRecyclingFactor', gs.perkUpgradeRecyclingFactor, '%');
            }

            // User groups
            renderUserGroups();
        }

        function setSliderValue(id, value, suffix = '', divisor = 1) {
            const slider = document.getElementById(id);
            if (slider && value !== undefined) {
                slider.value = value;
                updateSliderValue(id, suffix, divisor);
            }
        }

        // Render user groups
        function renderUserGroups() {
            const container = document.getElementById('userGroupsContainer');
            container.innerHTML = '';

            if (!config.userGroups || config.userGroups.length === 0) {
                config.userGroups = [];
            }

            config.userGroups.forEach((group, index) => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'user-group';
                groupDiv.innerHTML = `
                    <div class="user-group-header">
                        <span class="user-group-title">${group.name || 'User Group'}</span>
                        <button class="btn btn-danger btn-small" onclick="removeUserGroup(${index})">
                            <svg class="svg-icon" viewBox="0 0 24 24">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                            </svg>
                            Remove
                        </button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Group Name</label>
                            <input type="text" value="${group.name || ''}" onchange="updateUserGroup(${index}, 'name', this.value)">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="text" value="${group.password || ''}" onchange="updateUserGroup(${index}, 'password', this.value)">
                        </div>
                        <div class="form-group">
                            <label>Reserved Slots</label>
                            <input type="number" min="0" max="16" value="${group.reservedSlots || 0}" onchange="updateUserGroup(${index}, 'reservedSlots', parseInt(this.value))">
                        </div>
                        <div class="form-group">
                            <label>Can Kick/Ban Players</label>
                            <label class="toggle-switch">
                                <input type="checkbox" ${group.canKickBan ? 'checked' : ''} onchange="updateUserGroup(${index}, 'canKickBan', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Can Access Inventories</label>
                            <label class="toggle-switch">
                                <input type="checkbox" ${group.canAccessInventories ? 'checked' : ''} onchange="updateUserGroup(${index}, 'canAccessInventories', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Can Edit Base</label>
                            <label class="toggle-switch">
                                <input type="checkbox" ${group.canEditBase ? 'checked' : ''} onchange="updateUserGroup(${index}, 'canEditBase', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Can Extend Base</label>
                            <label class="toggle-switch">
                                <input type="checkbox" ${group.canExtendBase ? 'checked' : ''} onchange="updateUserGroup(${index}, 'canExtendBase', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                `;
                container.appendChild(groupDiv);
            });
        }

        function addUserGroup() {
            if (!config.userGroups) {
                config.userGroups = [];
            }
            config.userGroups.push({
                name: 'New Group',
                password: '',
                canKickBan: false,
                canAccessInventories: false,
                canEditBase: false,
                canExtendBase: false,
                reservedSlots: 0
            });
            renderUserGroups();
        }

        function removeUserGroup(index) {
            if (confirm('Are you sure you want to remove this user group?')) {
                config.userGroups.splice(index, 1);
                renderUserGroups();
            }
        }

        function updateUserGroup(index, field, value) {
            config.userGroups[index][field] = value;
        }

        // Save configuration
        function saveConfig() {
            collectConfigFromUI();

            const dataStr = JSON.stringify(config, null, '\t');
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'enshrouded_server.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('Configuration saved! Download started.');
        }

        // Collect UI data into config object
        function collectConfigFromUI() {
            config.name = document.getElementById('name').value;
            config.ip = document.getElementById('ip').value;
            config.queryPort = parseInt(document.getElementById('queryPort').value);
            config.slotCount = parseInt(document.getElementById('slotCount').value);
            config.enableTextChat = document.getElementById('enableTextChat').checked;
            config.enableVoiceChat = document.getElementById('enableVoiceChat').checked;
            config.voiceChatMode = document.getElementById('voiceChatMode').value;
            config.gameSettingsPreset = document.getElementById('gameSettingsPreset').value;

            if (!config.gameSettings) config.gameSettings = {};
            const gs = config.gameSettings;

            gs.playerHealthFactor = parseFloat(document.getElementById('playerHealthFactor').value);
            gs.playerManaFactor = parseFloat(document.getElementById('playerManaFactor').value);
            gs.playerStaminaFactor = parseFloat(document.getElementById('playerStaminaFactor').value);
            gs.playerBodyHeatFactor = parseFloat(document.getElementById('playerBodyHeatFactor').value);
            gs.enableDurability = document.getElementById('enableDurability').checked;
            gs.enableStarvingDebuff = document.getElementById('enableStarvingDebuff').checked;
            gs.foodBuffDurationFactor = parseFloat(document.getElementById('foodBuffDurationFactor').value);
            gs.fromHungerToStarving = parseInt(document.getElementById('fromHungerToStarving').value);
            gs.shroudTimeFactor = parseFloat(document.getElementById('shroudTimeFactor').value);
            gs.tombstoneMode = document.getElementById('tombstoneMode').value;
            gs.curseModifier = document.getElementById('curseModifier').value;
            gs.experienceCombatFactor = parseFloat(document.getElementById('experienceCombatFactor').value);
            gs.experienceMiningFactor = parseFloat(document.getElementById('experienceMiningFactor').value);
            gs.experienceExplorationQuestsFactor = parseFloat(document.getElementById('experienceExplorationQuestsFactor').value);
            gs.dayTimeDuration = parseInt(document.getElementById('dayTimeDuration').value);
            gs.nightTimeDuration = parseInt(document.getElementById('nightTimeDuration').value);
            gs.weatherFrequency = document.getElementById('weatherFrequency').value;
            gs.enableGliderTurbulences = document.getElementById('enableGliderTurbulences').checked;
            gs.tamingStartleRepercussion = document.getElementById('tamingStartleRepercussion').value;
            gs.randomSpawnerAmount = document.getElementById('randomSpawnerAmount').value;
            gs.aggroPoolAmount = document.getElementById('aggroPoolAmount').value;
            gs.pacifyAllEnemies = document.getElementById('pacifyAllEnemies').checked;
            gs.enemyDamageFactor = parseFloat(document.getElementById('enemyDamageFactor').value);
            gs.enemyHealthFactor = parseFloat(document.getElementById('enemyHealthFactor').value);
            gs.enemyStaminaFactor = parseFloat(document.getElementById('enemyStaminaFactor').value);
            gs.enemyPerceptionRangeFactor = parseFloat(document.getElementById('enemyPerceptionRangeFactor').value);
            gs.bossDamageFactor = parseFloat(document.getElementById('bossDamageFactor').value);
            gs.bossHealthFactor = parseFloat(document.getElementById('bossHealthFactor').value);
            gs.threatBonus = parseFloat(document.getElementById('threatBonus').value);
            gs.miningDamageFactor = parseFloat(document.getElementById('miningDamageFactor').value);
            gs.resourceDropStackAmountFactor = parseFloat(document.getElementById('resourceDropStackAmountFactor').value);
            gs.plantGrowthSpeedFactor = parseFloat(document.getElementById('plantGrowthSpeedFactor').value);
            gs.factoryProductionSpeedFactor = parseFloat(document.getElementById('factoryProductionSpeedFactor').value);
            gs.perkCostFactor = parseFloat(document.getElementById('perkCostFactor').value);
            gs.perkUpgradeRecyclingFactor = parseFloat(document.getElementById('perkUpgradeRecyclingFactor').value);

            config.saveDirectory = config.saveDirectory || './savegame';
            config.logDirectory = config.logDirectory || './logs';
        }

        // Export configuration
        function exportConfig() {
            collectConfigFromUI();
            const dataStr = JSON.stringify(config, null, '\t');
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'enshrouded_server.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Configuration exported!');
        }

        // Reset to defaults
        function resetToDefaults() {
            if (confirm('This will reset all settings to default values. Continue?')) {
                config = {
                    name: 'Enshrouded Server',
                    saveDirectory: './savegame',
                    logDirectory: './logs',
                    ip: '0.0.0.0',
                    queryPort: 15637,
                    slotCount: 16,
                    voiceChatMode: 'Proximity',
                    enableVoiceChat: false,
                    enableTextChat: false,
                    gameSettingsPreset: 'Default',
                    gameSettings: {},
                    userGroups: [
                        {
                            name: 'Admin',
                            password: 'AdminXXXXXXXX',
                            canKickBan: true,
                            canAccessInventories: true,
                            canEditBase: true,
                            canExtendBase: true,
                            reservedSlots: 0
                        },
                        {
                            name: 'Friend',
                            password: 'FriendXXXXXXXX',
                            canKickBan: false,
                            canAccessInventories: true,
                            canEditBase: true,
                            canExtendBase: false,
                            reservedSlots: 0
                        },
                        {
                            name: 'Guest',
                            password: 'GuestXXXXXXXX',
                            canKickBan: false,
                            canAccessInventories: false,
                            canEditBase: false,
                            canExtendBase: false,
                            reservedSlots: 0
                        }
                    ]
                };
                applyPreset('Default');
                loadConfigToUI();
                showNotification('Reset to default configuration!');
            }
        }

        // Show notification with enhanced animation
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.remove('hide');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
                notification.classList.add('hide');
            }, 3000);
        }

        // Initialize animated particles
        function initParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';

                // Random horizontal position
                particle.style.left = Math.random() * 100 + '%';

                // Random animation delay
                particle.style.animationDelay = Math.random() * 8 + 's';

                // Random animation duration
                particle.style.animationDuration = (6 + Math.random() * 4) + 's';

                // Random size variation
                const size = 2 + Math.random() * 3;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';

                particlesContainer.appendChild(particle);
            }
        }

        // Initialize smoke particles from torches
        function initTorchSmoke() {
            const smokeContainer = document.getElementById('torchSmoke');
            if (!smokeContainer) return;

            function createSmokeParticle(isLeft) {
                const smoke = document.createElement('div');
                smoke.className = 'smoke-particle';

                // Position based on torch location
                // Torches are positioned at left: -20px and right: -20px relative to header
                const baseX = isLeft ? 40 : smokeContainer.offsetWidth - 40;
                const baseY = 20; // Near top of torch flame

                smoke.style.left = baseX + (Math.random() * 15 - 7.5) + 'px';
                smoke.style.top = baseY + (Math.random() * 10) + 'px';

                // Random animation duration and direction
                const duration = 4 + Math.random() * 2;
                const direction = isLeft ? 1 : -1;
                smoke.style.animation = `smokeRise ${duration}s ease-out forwards`;

                // Add some horizontal drift variation
                smoke.style.setProperty('--drift-direction', direction);

                smokeContainer.appendChild(smoke);

                // Remove after animation
                setTimeout(() => {
                    if (smoke.parentNode) {
                        smoke.remove();
                    }
                }, duration * 1000 + 100);
            }

            // Create smoke particles periodically
            setInterval(() => {
                createSmokeParticle(true); // Left torch
            }, 600);

            setInterval(() => {
                createSmokeParticle(false); // Right torch
            }, 700);

            // Create initial burst
            setTimeout(() => {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => createSmokeParticle(true), i * 200);
                    setTimeout(() => createSmokeParticle(false), i * 200);
                }
            }, 500);
        }

        // Initialize slider progress on page load
        function initSliders() {
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                const min = parseFloat(slider.min);
                const max = parseFloat(slider.max);
                const percentage = ((slider.value - min) / (max - min)) * 100;
                slider.style.setProperty('--range-progress', percentage + '%');
            });
        }

        // Load config on page load
        window.addEventListener('load', () => {
            loadConfig();
            initParticles();
            initTorchSmoke();
            initSliders();
        });
    </script>
</body>
</html>
